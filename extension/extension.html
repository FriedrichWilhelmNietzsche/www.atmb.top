<!DOCTYPE html>
<html>
<head>
  <title id="title">拓展模块</title>
  <meta charset="utf-8">
  <meta name="theme-color" content="#ff7f50">
  <meta name="msapplication-TileColor" content="#ff7f50">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link rel="shortcut icon" href="/images/leaves.png">

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css">
  <link rel="stylesheet" href="../css/navbar.css">
  <link rel="stylesheet" href="../css/global.css">
  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  <script src='//unpkg.com/valine/dist/Valine.min.js'></script>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.3.1/dist/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vue"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js"></script>
  <script src="../lib/markdown/js/Parser.js"></script>
  <script src="../js/counter.js"></script>
  <script>
    var vm = null;
    function getUrlParam(name){
      var reg = new RegExp("(^|&)" + name + "=([^&]*)(&|$)"); //构造一个含有目标参数的正则表达式对象
      var r = window.location.search.substr(1).match(reg);  //匹配目标参数
      if (r != null) return unescape(r[2]); return null; //返回参数值
    }
    function initVue(){
      vm = new Vue({
        el:"#information",
        data:{
          ext:null,
          descMarkDown:null,
          downloadCount:null,
        },
        methods:{
          onClickDownload:function(){
            window.location = this.ext.downloadUrl;
            addDownloadCount(this.ext.id);
          }
        }
      });
    }
    function fetchData(){
      var fileName = getUrlParam("j");
      fetch(fileName)
      .then(res=>res.text())
      .then(text=>{
        var json = eval("(" + text + ")");
        vm.$data.ext = json;
        document.title = json.name +"-秋之盒拓展";
        var parser = new HyperDown(); 
        var html = parser.makeHtml(json.desc);
        vm.$data.ext.descMarkDown = html;
        console.log(vm.$data.ext.descMarkDown);
        queryDownloadCount(json.id,function(count){
          vm.$data.downloadCount = count;
        });
      })
    }
    function initComments(){
      new Valine({
          el: '#vcomments',
          placeholder:"遵守法律法规，理性讨论，写下你的建议与评论",
          appId: 'VLA81Yn1kDUEgE9A99Qwnb1u-gzGzoHsz',
          appKey: 'CpivAcjiG4W9BWNpS2z47X98'
      });
    }
  </script>
</head>
<body>
  <nav class="navbar navbar-default navbar-fixed-top" role="navigation" style="border-radius: 0px;">
        <div class="container-fluid">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse"
                  data-target="#navbar-c">
                  <span class="sr-only">切换导航</span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                  <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="/">秋之盒</a>
            </div>
            <div class="collapse navbar-collapse" id="navbar-c">
                <ul class="nav navbar-nav">
                  <li><a href="../"><span class="glyphicon glyphicon-home"> 主页</a></li>
                  <li class="active"><a href="../extension/"><span class="glyphicon glyphicon-th"> 拓展模块</a></li>
                  <li><a href="../about/"><span class="glyphicon glyphicon-leaf"> 关于/联系</a></li>
                  <li><a href="../donate/"><span class="glyphicon glyphicon-heart-empty"> 开源/捐赠</a></li>
                </ul>
            </div>
        </div>
  </nav>    

  <div class="container" style="background: whitesmoke;">
    <div class="firstele"></div>
      <div id="information" style="text-align: center;">
          <div v-if="ext != null">
            <h1>{{ext.name}}<span class="badge">{{downloadCount}}下载</h1>
            <h4>@{{ext.auth}}</h4>
            <h4>版本:{{ext.version}}</h4>
            <!-- <h4 v-if="ext.minSdk != null">最低SDK:{{ext.minSdk}} 目标SDK{{ext.targetSdk}}</h4> -->
            <!-- <button v-if="ext.minSdk != null" type="button" class="btn btn-danger" onclick="window.open('https://github.com/zsh2401/AutumnBox/wiki/zh_CN_SDK%E7%89%88%E6%9C%AC%E5%85%B3%E7%B3%BB%E5%AF%B9%E7%85%A7%E8%A1%A8')">
              秋之盒版本与API版本对照表</button><br><br> -->
            <button type="button" class="btn btn-success" v-on:click="onClickDownload">立刻获取</span></button>
            <button type="button" class="btn btn-danger" onclick="window.location='./'">返回上一级</button>
            <div v-if="ext.descMarkDown != null">
                <h3>说明</h3>
                <p v-html="ext.descMarkDown">xxx</p>
            </div>
          </div>
          <div v-else>
            <h1>加载中...</h1>
          </div>
        </div>
        <div id="vcomments"></div>
  </div>
  <script>
    initVue();
    fetchData();
    initComments();
  </script>
  <div style="display:none"><script src="https://s13.cnzz.com/z_stat.php?id=1272395513&web_id=1272395513" language="JavaScript"></script></div>
  </body>
</html>